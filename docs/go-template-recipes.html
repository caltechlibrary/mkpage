<!DOCTYPE html>
<html>
<head>
    <title>Caltech Library's Digital Library Development Sandbox</title>
    <link rel="stylesheet" href="/css/site.css">
</head>
<body>
<header>
<a href="http://library.caltech.edu"><img src="/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
<li><a href="/">Home</a></li>
<li><a href="../">Up</a></li>
<li><a href="./mkrss.html">mkrss</a></li>
<li><a href="./mkpage.html">mkpage</a></li>
<li><a href="./urlencode.html">urlencode</a></li>
<li><a href="./go-template-recipes.html">Go text/template recipes</a></li>
<li><a href="./titleline.html">titleline</a></li>
<li><a href="./slides/three-slides.html">Title Page</a></li>
<li><a href="./byline.html">byline</a></li>
<li><a href="./ws.html">ws</a></li>
<li><a href="./frontmatter.html">frontmatter</a></li>
<li><a href="./mkpongo.html">mkpongo</a></li>
<li><a href="./urldecode.html">urldecode</a></li>
<li><a href="./sitemapper.html">sitemapper</a></li>
<li><a href="./reldocpath.html">reldocpath</a></li>
</ul>

</nav>

<section>
<h1 id="go-texttemplate-recipes">Go text/template recipes</h1>
<p><em>mkpage</em> template engine is Go’s <a href="https://golang.org/pkg/text/template/">text/template</a>. Go’s templates provide a flexible and simple <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> describing how to assemble a document based on a data structure passed to it. <em>mkpage</em> uses a list of key/value pairs on the command line to populate the data structure the template package expects. This includes support for JSON formatted text from strings, files and URL response. It also support transforming markdown content into HTML before assembling the final template.</p>
<p>While Go’s template package is not complicated to use it doesn’t come with allot of examples or tutorials. Most articles you find on Go’s template packages either focus on web server code or are for sophisticated static content generators like <a href="http://gohugo.io">Hugo</a>. Hugo extends Go’s template DSL providing capabilities that rival or surpose older static content generators like <a href="https://jekyllrb.com/">Jekyll</a> and <a href="http://jade-lang.com/">Jade</a>.</p>
<p><em>mkpage</em> uses Go v1.7’s template package as is. No bells or whistles. That isn’t necessarily a bad thing. <em>mkpage</em> is meant to be a an easy system for producing <em>simple content</em> from plain text, markdown text, and JSON. The limit set of features is itself a feature of <em>mkpage</em>. Other systems like <a href="https://gohugo.io">Hugo</a> are what you want if your have more complicated needs.</p>
<p>While vanilla Go templates are not as richly featured they are suitable for a wide variety of content from webpages, to XML feed document to BibTeX files. This recipe list demonstrates some of Go’s template capabilities as well as how to leverage the simple capabilities of <em>mkpage</em> to solve common data rendering problems. In this set of tutorials you’ll walk through both examples of how to use <em>mkpage</em> as well as write simple Go templates.</p>
<h2 id="the-recipes">The Recipes</h2>
<h3 id="only-three-data-formats-are-supported">only three data formats are supported</h3>
<p><em>mkpage</em> supports three formats of text</p>
<ul>
<li>text/plain</li>
<li>text/markdown</li>
<li>application/json</li>
</ul>
<h3 id="only-three-data-sources-are-supported">only three data sources are supported</h3>
<p><em>mkpage</em> supports three data sources</p>
<ul>
<li>explicit strings (prividing a hint prefix, e.g. “text:”, “markdown:”, “json:”)</li>
<li>files (the default data source)</li>
<li>URLs as data sources (prefixed with http:// and https:// as appropriate)</li>
</ul>
<h3 id="examples">Examples</h3>
<h4 id="explicit-stings-a-get-well-card">explicit stings, a get well card</h4>
<p>In this example we want to add a name to a simple get well message.</p>
<p>Our template is called <em><a href="examples/get-well.tmpl">get-well.tmpl</a></em>. It looks like</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1"></a>    Dear {{ .name -}},</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>    Hope you are feeling better today.</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>    Sencerly,</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>    Mojo Sam</span></code></pre></div>
<p>On the command line we can run <em>mkpage</em> with the following options</p>
<pre class="shell"><code>    mkpage &quot;name=text:Little Frieda&quot; get-well.tmpl</code></pre>
<p>The output would look like</p>
<pre class="text"><code>    Little Frieda,

    Hope you are feeling better today.

    Sencerly,

    Mojo Sam</code></pre>
<h5 id="explanation">Explanation</h5>
<p>The key “name” has a string value of “Little Frieda”. The template indicates this needs to be included after the word “Dear”. The key “name” is proceeded by a period or dot. The substitution happens between the opening “{{” and closing “}}”. Notice the “-” before the closing “}}”. This tells the template engine to not allow spacas after the value and the next non-space character (i.e. the comma of the opening line).</p>
<h4 id="json-data-a-keyvalue-blob-report">JSON data, a key/value blob report</h4>
<p>In this example we construct a JSON object as part of the key/value pairs on the command line and pass it through the blob.tmpl template that displays they pairs.</p>
<p>The command envokation looks like</p>
<pre class="shell"><code>    mkpage &#39;blob=json:{&quot;one&quot;:1,&quot;two&quot;:2}&#39; blob.tmpl</code></pre>
<p>The template is a simple range construct (e.g. <a href="examples/blob.tmpl">blob.tmpl</a>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1"></a>    {{<span class="kw">range</span> $key,$val := .blob }}</span>
<span id="cb5-2"><a href="#cb5-2"></a>        Key: {{ $key }} Value: {{ $val -}}</span>
<span id="cb5-3"><a href="#cb5-3"></a>    {{end}}</span></code></pre></div>
<p>Results in text like</p>
<pre class="text"><code>    
       Key: one Value: 1
       Key: two Value: 2
</code></pre>
<h5 id="explanation-1">Explanation</h5>
<p>We use the range function to iterate over the key/value pairs of our JSON object. Additionally we assign those values to the template variables called “<span class="math inline">$key" and "$</span>val”. These are then used to format our output. Also notice the trailing values “-” which supresses and extra new line.</p>
<h3 id="files-are-data-source">Files are data source</h3>
<h4 id="wraping-a-markdown-document-in-html">Wraping a Markdown document in HTML</h4>
<p>In this example we want to embed a “story” in a simple HTML document. The <em>story</em> is written in Markdown format. Here’s the simple template (i.e. <a href="examples/simple-page.tmpl">simple-page.tmpl</a>)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1"></a>    &lt;!DOCTYPE html&gt;</span>
<span id="cb7-2"><a href="#cb7-2"></a>    &lt;html&gt;</span>
<span id="cb7-3"><a href="#cb7-3"></a>        &lt;head&gt;&lt;title&gt;Stories&lt;/title&gt;&lt;/head&gt;</span>
<span id="cb7-4"><a href="#cb7-4"></a>        &lt;body&gt;</span>
<span id="cb7-5"><a href="#cb7-5"></a>        {{ .story }}</span>
<span id="cb7-6"><a href="#cb7-6"></a>        &lt;/body&gt;</span>
<span id="cb7-7"><a href="#cb7-7"></a>    &lt;/html&gt;</span></code></pre></div>
<p>The command line would look something like</p>
<pre class="shell"><code>    mkpage &quot;story=my-story.md&quot; simple-page.tmpl &gt; my-story.html</code></pre>
<h5 id="explanation-2">Explanation</h5>
<p>On the command line <em>story</em> is assumed to point to a file named “my-story.md”. The reason a file is assumed is because there is no hint prefix or URL prefix at the start of the value. Because the file ends in the file extension “.md” it is assume to be a Markdown file and processed accordingly before being assemble in the template.</p>
<h3 id="url-as-data-source">URL as data source</h3>
<h4 id="json-data-a-weather-forecast">JSON data, a weather forecast</h4>
<p>In this example we get the current weather forecast for Guam. The source of the weather information is <a href="http://noaa.gov">NOAA</a>’s <a href="http://weather.gov">National Weather Services</a> website. By including the parameter “FcstType=json” at the end of the URL you get a JSON version of the weather forecast rather than the HTML or XML alternatives.</p>
<ul>
<li>data source: http://forecast.weather.gov/MapClick.php?lat=13.47190933300044&amp;lon=144.74977715100056&amp;FcstType=json</li>
</ul>
<p>Our template will be call <em><a href="examples/forecast.tmpl">forecast.tmpl</a></em>. It will be used to produce a Markdown file of weather related information obtained from the JSON response.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb9-1"><a href="#cb9-1"></a>    {{with $co := .forecast.currentobservation}}</span>
<span id="cb9-2"><a href="#cb9-2"></a>    Current Observation:</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>        + {{ $co.name }}</span>
<span id="cb9-5"><a href="#cb9-5"></a>        + Elevation: {{ $co.elev }}</span>
<span id="cb9-6"><a href="#cb9-6"></a>        + Latitude: {{ $co.latitude }}</span>
<span id="cb9-7"><a href="#cb9-7"></a>        + Longitude: {{ $co.longitude }}</span>
<span id="cb9-8"><a href="#cb9-8"></a>        + Date: {{ $co.Date }}</span>
<span id="cb9-9"><a href="#cb9-9"></a>        + Temp: {{ $co.Temp }}</span>
<span id="cb9-10"><a href="#cb9-10"></a>        + Dew Point: {{ $co.Dewp }}</span>
<span id="cb9-11"><a href="#cb9-11"></a>        + Relative Humidity: {{ $co.Relh }}</span>
<span id="cb9-12"><a href="#cb9-12"></a>        + Winds: {{ $co.Winds }}</span>
<span id="cb9-13"><a href="#cb9-13"></a>        + Wind direction: {{ $co.Windd }}</span>
<span id="cb9-14"><a href="#cb9-14"></a>        + Gust: {{ $co.Gust }}</span>
<span id="cb9-15"><a href="#cb9-15"></a>        + Visibility: {{ $co.Visibility }}</span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a>    {{end}}</span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a>    Forecast:</span>
<span id="cb9-20"><a href="#cb9-20"></a>    {{<span class="kw">range</span> .forecast.data.text }}</span>
<span id="cb9-21"><a href="#cb9-21"></a>        + {{ . -}}</span>
<span id="cb9-22"><a href="#cb9-22"></a>    {{end}}</span></code></pre></div>
<p>The command line for <em>mkpage</em> would look like</p>
<pre class="shell"><code>    mkpage &quot;forecast=http://forecast.weather.gov/MapClick.php?lat=13.47190933300044&amp;lon=144.74977715100056&amp;FcstType=json&quot; forecast.tmpl</code></pre>
<p>The resulting page should look something like</p>
<pre class="text"><code>
    Current Observation:

        + Agana, Guam International Airport
        + Elevation: 299
        + Latitude: 13.48
        + Longitude: 144.8
        + Date: 5 Aug 08:54 am ChST
        + Temp: 82
        + Dew Point: 79
        + Relative Humidity: 89
        + Winds: 12
        + Wind direction: 220
        + Gust: 0
        + Visibility: 10.00


    Forecast:

        + Scattered showers and thunderstorms.  Mostly cloudy, with a high near 84. Breezy, with a southwest wind 23 to 25 mph, with gusts as high as 32 mph.  Chance of precipitation is 40%.
        + Scattered showers and thunderstorms.  Mostly cloudy, with a low around 79. Breezy, with a southwest wind 15 to 20 mph, with gusts as high as 25 mph.  Chance of precipitation is 40%.
        + Mostly cloudy, with a high near 88. Heat index values as high as 99. Breezy, with a southwest wind 17 to 21 mph, with gusts as high as 26 mph. 
        + Mostly cloudy, with a low around 79. Southwest wind 13 to 17 mph, with gusts as high as 22 mph. 
        + Mostly cloudy, with a high near 88. Southwest wind 14 to 17 mph, with gusts as high as 22 mph. 
        + Mostly cloudy, with a low around 79.
        + Mostly sunny, with a high near 89.
        + Partly cloudy, with a low around 80.
        + Scattered showers and thunderstorms.  Mostly cloudy, with a high near 89. Chance of precipitation is 40%.
        + Scattered showers and thunderstorms.  Mostly cloudy, with a low around 79. Chance of precipitation is 40%.
        + Scattered showers and thunderstorms.  Mostly cloudy, with a high near 89. Chance of precipitation is 40%.
        + Scattered showers and thunderstorms.  Mostly cloudy, with a low around 79. Chance of precipitation is 40%.
        + Partly sunny, with a high near 89.</code></pre>
<h3 id="multiple-templates">Multiple templates</h3>
<p>It is come in more complex website to separate elements into their own templates and pull them together with a master one. In this example will use three tempaltes - <a href="examples/letter.tmpl">letter.tmpl</a> (the master template), <a href="examples/signature.tmpl">signature.tmpl</a> and <a href="examples/postscript.tmpl">postscript.tmpl</a>.</p>
<h4 id="letter.tmpl">letter.tmpl</h4>
<pre class="template"><code>    {{- with .ToName}}Hello {{ . -}},{{- else}}Hello,{{end}}
    
    This is an example of a letter.
    
    Sincerly,
    
    {{ template &quot;signature.tmpl&quot; . }}
    
    {{ template &quot;postscript.tmpl&quot; . }}</code></pre>
<h4 id="signature.tmpl">signature.tmpl</h4>
<pre class="template"><code>    {{with .Name}}{{- . -}}{{else}}Anonymous{{end}}</code></pre>
<h4 id="postscript.tmpl">postscript.tmpl</h4>
<pre class="template"><code>    (P. S. {{with .ToName}}{{- . }}, {{end -}} what is coming at is coming from you)</code></pre>
<h4 id="putting-it-together">Putting it together</h4>
<pre class="shell"><code>    mkpage &quot;ToName=text:Mojo Sam&quot; &quot;Name=text:Jack Flanders&quot; \
        examples/letter.tmpl examples/signature.tmpl examples/postscript.tmpl</code></pre>
<h4 id="this-output">This output</h4>
<p>Should be something like–</p>
<pre><code>    Hello Mojo Sam,
    
    This is an example of a letter.
    
    Sincerly,
    
    Jack Flanders
    
    (P. S. Mojo Sam, what is coming at is coming from you)</code></pre>

</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2020 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>