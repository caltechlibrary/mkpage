<!DOCTYPE html>
<html>
<head>
    <title>Caltech Library's Digital Library Development Sandbox</title>
    <link rel="stylesheet" href="/css/site.css">
</head>
<body>
<header>
<a href="http://library.caltech.edu"><img src="/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
<li>
<a href="/">Home</a>
</li>
<li>
<a href="../">Up</a>
</li>
<li>
<a href="the-basics.html">The Basics</a>
</li>
<li>
<a href="one-element/">One Element</a>
</li>
<li>
<a href="simple/">Simple</a>
</li>
<li>
<a href="simple-with-nav/">Simple w/Nav</a>
</li>
<li>
<a href="go-template-recipes.html">Template Recipes</a>
</li>
<li>
<a href="fountain-demo/">Fountain Demo</a>
</li>
</ul>
</nav>

<section>
<h1 id="the-basics">
The Basics
</h1>
<p>
<em>mkpage</em> uses Go’s text/templates for rendering content. This template system was inspired by simple templates like <a href="https://mustache.github.io/">Mustache</a> and <a href="http://handlebarsjs.com/">Handlebars</a>. While Go’s templates can be simple the systems lacks documentation. As a remedy I’ve collected few simple examples here based on my experience developing websites with <em>mkpage</em> and <em>mkslides</em>.
</p>
<h2 id="basic-element">
Basic element
</h2>
<p>
Like Mustache and Handlebars Go text/templates use double curly brackets to indicate an element which is to be replace. A template that says “Hello” would look something like this
</p>
<pre><code>    {{ define &quot;hello-world.tmpl&quot; }}Hello {{ .World }}{{ end }}</code></pre>
<p>
We can use the template to say Hello to “Georgina”
</p>
<pre class="shell"><code>    echo &#39;{{ define &quot;hello-world.tmpl&quot; }}Hello {{ .World }}{{ end }}&#39; &gt; hello-world.tmpl
    mkpage &quot;World=text:Georgina&quot; hello-world.tmpl</code></pre>
<p>
Running these two command should result in output like
</p>
<pre><code>    Hello Georgina</code></pre>
<p>
The line with the <code>echo</code> is just creating our template and saving it as the file <em>hello-world.tmpl</em>. In the template the only special part is <code>{{ .World }}</code>. “.World” is a variable, as indicated by the initial ‘.’. “.World” will be replaced by something we define. In the line with <code>mkpage</code> we define the value for “.World”. Note we don’t need to prefix “World” with a dot like we did in the template. We use ‘text’ before the variable name to indicate the type of object. The line tells the template to replace <code>{{ .World }}</code> with the text “Georgina”. The last part of the command instructs <em>mkpage</em> to use our <em>hello-world.tmpl</em> template.
</p>
<p>
If we did not include <code>World=…</code> with the <em>mkpage</em> command using the <em>hello-world.tmpl</em> template <em>mkpage</em> would return output like
</p>
<pre><code>    Hello &lt;no value&gt;</code></pre>
<p>
If we included other key/value pairs not mentioned in the template they would be silently ignored.
</p>
<p>
If we made a typo in <em>hello-world.tmpl</em> then we would see an error message.
</p>
<p>
Try the following to get a feel for how key/value pairs work with <em>mkpage</em>. The first two will render but display <code>Hello &lt;no value&gt;</code>. The first example fails because no value is provided and the second fails because the value provided doesn’t match what is in the template (notice the typo “Wrold” vs. “World”). The next one will display an error because <em>text:</em> wasn’t included on the value side of the key/value pair. By default <em>mkpage</em> assumes the value is refering to a file and in this case can’t find the file Georgina in your current directory.<br /> The last two will display <code>Hello Georgina</code> should display since the value for “World” is provided. The last one just ignores “Name=text:Fred” because name isn’t found in the template.
</p>
<pre class="shell"><code>    mkpage hello-world.tmpl
    mkpage &quot;Wrold=text:Georgina&quot; hello-world.tmpl
    mkpage &quot;World=Georgina&quot; hello-world.tmpl
    mkpage &quot;World=text:Georgina&quot; &quot;Name=text:Fred&quot; hello-world.tmpl
    mkpage &quot;World=text:Georgina&quot; hello-world.tmpl</code></pre>
<h3 id="conditional-elements">
Conditional elements
</h3>
<p>
One nice feature of Go’s text template is that template elements can be condition. This can be done using the “if” and “with” template functions. Here’s how to show a title conditionally using the “if” function.
</p>
<div id="cb6" class="sourceCode">
<pre class="sourceCode go"><code class="sourceCode go"><span id="cb6-1"><a href="#cb6-1"></a>    {{<span class="kw">if</span> .title}}And the title is: {{.title}}{{end}}</span></code></pre>
</div>
<p>
or using “with”
</p>
<div id="cb7" class="sourceCode">
<pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1"></a>    {{with .title}}{{ . }}{{end}}</span></code></pre>
</div>
<p>
Let’s create a template file with both these statements called <em>title-demo.tmpl</em> and run the <em>mkpage</em> command.
</p>
<pre class="shell"><code>    echo &#39;{{ define &quot;title-demo.tmpl&quot; }}&#39; &gt; title-demo.tmpl
    echo &quot;{{if .title}}If this title: {{.title}}{{end}}&quot; &gt;&gt; title-demo.tmpl
    echo &quot;{{with .title}}With this title: {{ . }}{{end}}&quot; &gt;&gt; title-demo.tmpl 
    echo &#39;{{ end }}&#39; &gt;&gt; title-demo.tmpl
    mkpage &quot;title=text:This is a title demo&quot; title-demo.tmpl</code></pre>
<p>
The output should look like
</p>
<pre><code>    If this title: This is a title demo
    With this title: This is a title demo</code></pre>
<p>
In the first line with the <em>if</em> we use “.title” as the variable, just like “.World” in our first example. In the second line we can refer to the value as “.” because we used the <em>with</em> conditional.<br /> The reason we prefix variable names with dot (period) is because we are actually describing a path or context of object relationships. I like to think of the starting dot as “this here” or simply “this”.<br /> So in the “with” line we are saying “with this title do something” up until the <code>{{end}}</code>. We can refer to “.title” simply as “this thing” or <code>{{ . }}</code>, which will be replaced with the value of “.title”.
</p>
<p>
What happens if you run this command?
</p>
<pre class="shell"><code>    mkpage title-demo.tmpl</code></pre>
<p>
This produces two empty lines of output. The reason we don’t see something like
</p>
<pre><code>    If this title: &lt;no value&gt;
    With this title: &lt;no value&gt;</code></pre>
<p>
is because <em>if</em> and <em>with</em> are conditionally writing the value of title if it has been set. This becomes a useful tool when you have content that may or may not exist depending on the page you’re processing.
</p>
<h3 id="template-blocks">
Template blocks
</h3>
<p>
Go text/templates support defining blocks and rendering them in conjuction with a main template. This is also supported by <em>mkpage</em>. Each template encountered on the command line is added to an array of templates parsed by the text/template package. Each template will be executed and the final results will render to stdout by <em>mkpage</em>.
</p>
<pre class="shell"><code>    mkpage &quot;content=text:Hello World&quot; testdata/page.tmpl testdata/header.tmpl testdata/footer.tmpl</code></pre>
<p>
Here is what <em>page.tmpl</em> would look like
</p>
<div id="cb13" class="sourceCode">
<pre class="sourceCode go"><code class="sourceCode go"><span id="cb13-1"><a href="#cb13-1"></a>    {{ define <span class="st">&quot;page.tmpl&quot;</span> }}</span>
<span id="cb13-2"><a href="#cb13-2"></a>    {{template <span class="st">&quot;header&quot;</span> . }}</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>        {{.content}}</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a>    {{template <span class="st">&quot;footer&quot;</span> . }}</span>
<span id="cb13-7"><a href="#cb13-7"></a>    {{ end }}</span></code></pre>
</div>
<p>
The header and footer are then defined in their own template files (though they also could be combined into one or even be defined in the main template file itself).
</p>
<p>
<em>header.tmpl</em>
</p>
<div id="cb14" class="sourceCode">
<pre class="sourceCode go"><code class="sourceCode go"><span id="cb14-1"><a href="#cb14-1"></a>    {{define <span class="st">&quot;header&quot;</span>}}This is the document header{{end}}</span></code></pre>
</div>
<p>
<em>footer.tmpl</em>
</p>
<div id="cb15" class="sourceCode">
<pre class="sourceCode go"><code class="sourceCode go"><span id="cb15-1"><a href="#cb15-1"></a>    {{define <span class="st">&quot;footer&quot;</span>}}This is the footer{{end}}</span></code></pre>
</div>
<p>
In this example the output would look like
</p>
<pre class="text"><code>    This is the document header

        Hello World

    This is the footer</code></pre>
<h2 id="content-formats-and-data-sources">
Content formats and data sources
</h2>
<p>
<em>mkpage</em> understands three content formats
</p>
<ul>
<li>
text/plain (e.g. “text:” strings and any file expect those having the extension “.md” or “.json”)
</li>
<li>
text/markdown (e.g. “markdown:” strings and file extension “.md”)
</li>
<li>
application/json (e.g. “json:” strings and file extension “.json”)
</li>
</ul>
<p>
It also supports three data sources
</p>
<ul>
<li>
an explicit string (prefixed with a format, e.g. “text:”, “markdown:”, “json:”)
</li>
<li>
a filepath and filename (the default data source)
</li>
<li>
a URL (identified by the URL prefixes http:// and https://)
</li>
</ul>
<p>
Content type is evaluated, transformed (if necessary), and sent to the Go text/template.
</p>
<p>
Create a template called <em>data-source-demo.tmpl</em>. It would look like
</p>
<pre><code>    {{ define &quot;data-source-demo.tmpl&quot; }}
    This is a plain text string: &quot;{{ .string }}&quot;

    Below is a an included file:
    {{ .file }}
    
    Finally below is data from a URL:
    {{ .url }}
    {{ end }}</code></pre>
<p>
Create a text file named <em>hello.md</em>.
</p>
<pre><code>    # this is a file

    Hello World!</code></pre>
<p>
Type the following
</p>
<pre class="shell"><code>    mkpage &quot;string=text:Hello World&quot; &quot;file=hello.md&quot; \
      &quot;url=https://raw.githubusercontent.com/caltechlibrary/mkpage/master/nav.md&quot; \
      data-source-demo.tmpl</code></pre>
<p>
What do you see?
</p>
<h2 id="a-note-about-markdown-dialect">
A note about Markdown dialect
</h2>
<p>
<em>mkpage</em> implements <a href="https://guides.github.com/features/mastering-markdown/#GitHub-flavored-markdown">Github Flavored Markdown</a> using the <a href="https://github.com/gomarkdown/markdown">gomarkdown</a> markdown processor. This is a superset of <a href="http://daringfireball.net/projects/markdown/">Markdown</a> as created by John Gruber.
</p>
<p>
The markdown processor is invoked for values with the “markdown:” hint prefix, files ending in “.md” extension or URL content with the content type returned as “text/markdown” (i.e.  content with a type of “text/plain” does not use the markdown process and is treated as plain text).
</p>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2015 - 2020 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
